{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>{{ horse.name }}</h2>
  <div class="muted">Prahy: {{ horse.walk_trot_kmh or 7.0 }} / {{ horse.trot_canter_kmh or 13.0 }} km/h</div>
</section>

<section class="card">
  <form class="grid2" method="get">
    <input type="date" name="from" value="{{ q_from or '' }}">
    <input type="date" name="to" value="{{ q_to or '' }}">
    <button>Filtrovat</button>
  </form>
</section>

<section class="grid-2">
  <div class="card">
    <h3>Přehled</h3>
    <div class="grid2">
      <div><div class="muted">Jízd</div><div><b>{{ stats.count }}</b></div></div>
      <div><div class="muted">Km celkem</div><div><b>{{ '%.2f' % stats.km }}</b></div></div>
      <div><div class="muted">Ø rychlost</div><div><b>{{ '%.2f' % stats.avg }}</b></div></div>
      <div><div class="muted">Max rychlost</div><div><b>{{ '%.2f' % stats.max }}</b></div></div>
    </div>
  </div>
  <div class="card">
    <h3>Měsíce / Roky</h3>
    <div id="chart_months"></div>
  </div>
</section>

<section class="card">
  <h3>Jízdy</h3>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Datum</th><th>Název</th><th>Km</th><th>Ø</th><th>Max</th></tr></thead>
      <tbody>
        {% for r in rides %}
        <tr>
          <td>{{ r.ride_date }}</td>
          <td><a href="/ride/{{ r.id }}">{{ r.title or ('Jízda #' ~ r.id) }}</a></td>
          <td>{{ '%.2f' % r.distance_km }}</td>
          <td>{{ '%.2f' % r.avg_speed_kmh }}</td>
          <td>{{ '%.2f' % r.max_speed_kmh }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<script>
const months = {{ month_series | safe }};
Plotly.newPlot('chart_months', [{
  x: months.map(m=>m.label),
  y: months.map(m=>m.km),
  type: 'bar'
}], {title:'Najeté km podle měsíců', margin:{t:30}, displayModeBar:false});
</script>
{% endblock %}
