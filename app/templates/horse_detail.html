{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>{{ horse.name }}</h2>
  <div class="muted">Prahy: {{ horse.walk_trot_kmh or 7.0 }} / {{ horse.trot_canter_kmh or 13.0 }} km/h</div>
</section>

<section class="card">
  <form class="grid2" method="get">
    <input type="date" name="from" value="{{ q_from or '' }}">
    <input type="date" name="to" value="{{ q_to or '' }}">
    <button>Filtrovat</button>
  </form>
</section>

<section class="grid-2">
  <div class="card">
    <h3>Přehled</h3>
    <div class="grid2">
      <div><div class="muted">Jízd</div><div><b>{{ stats.count }}</b></div></div>
      <div><div class="muted">Km celkem</div><div><b>{{ '%.2f' % stats.km }}</b></div></div>
      <div><div class="muted">Ø rychlost</div><div><b>{{ '%.2f' % stats.avg }}</b></div></div>
      <div><div class="muted">Max rychlost</div><div><b>{{ '%.2f' % stats.max }}</b></div></div>
    </div>
    <div id="gauge_avg" style="height:150px;"></div>
    <div id="gauge_max" style="height:150px;"></div>
  </div>
  <div class="card">
    <h3>Měsíce / Týdny / Roky</h3>
    <div id="chart_months"></div>
    <div id="chart_weeks"></div>
    <div id="chart_years"></div>
  </div>
</section>

<section class="card">
  <h3>Jízdy</h3>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Datum</th><th>Název</th><th>Km</th><th>Ø</th><th>Max</th></tr></thead>
      <tbody>
        {% for r in rides %}
        <tr>
          <td>{{ r.ride_date }}</td>
          <td><a href="/ride/{{ r.id }}">{{ r.title or ('Jízda #' ~ r.id) }}</a></td>
          <td>{{ '%.2f' % r.distance_km }}</td>
          <td>{{ '%.2f' % r.avg_speed_kmh }}</td>
          <td>{{ '%.2f' % r.max_speed_kmh }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

<script>
const months = {{ month_series | safe }};
Plotly.newPlot('chart_months', [{
  x: months.map(m=>m.label),
  y: months.map(m=>m.km),
  type: 'bar'
}], {title:'Najeté km podle měsíců', margin:{t:30}, displayModeBar:false});

const weeks = {{ week_series | safe }};
Plotly.newPlot('chart_weeks', [{
  x: weeks.map(m=>m.label),
  y: weeks.map(m=>m.km),
  type: 'bar'
}], {title:'Najeté km podle týdnů', margin:{t:30}, displayModeBar:false});

const years = {{ year_series | safe }};
Plotly.newPlot('chart_years', [{
  x: years.map(m=>m.label),
  y: years.map(m=>m.km),
  type: 'bar'
}], {title:'Najeté km podle let', margin:{t:30}, displayModeBar:false});

Plotly.newPlot('gauge_avg', [{
  type: 'indicator',
  mode: 'gauge+number',
  value: {{ '%.2f' % stats.avg }},
  title: {text: 'Ø rychlost'},
  gauge: {axis: {range: [0, 50]}}
}], {margin:{t:30}, displayModeBar:false});

Plotly.newPlot('gauge_max', [{
  type: 'indicator',
  mode: 'gauge+number',
  value: {{ '%.2f' % stats.max }},
  title: {text: 'Max rychlost'},
  gauge: {axis: {range: [0, 50]}}
}], {margin:{t:30}, displayModeBar:false});
</script>
{% endblock %}
