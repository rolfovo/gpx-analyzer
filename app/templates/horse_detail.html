{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>Kůň: {{ horse.name }}</h2>
  <p><a class="button" href="/export/horse/{{ horse.id }}.csv">Export CSV</a></p>
</section>

<section class="card">
  <h3>Souhrn podle chodů (hranice {{ '%.1f' % thrA }} / {{ '%.1f' % thrB }} km/h)</h3>
  <table>
    <thead><tr><th>Chod</th><th>Km</th><th>Podíl</th></tr></thead>
    {% set total = gaits.total_km or 0.0001 %}
    <tbody>
      <tr><td>Chůze</td><td>{{ '%.2f' % gaits.walk_km }}</td><td>{{ '%.0f' % (gaits.walk_km/total*100) }}%</td></tr>
      <tr><td>Klus</td><td>{{ '%.2f' % gaits.trot_km }}</td><td>{{ '%.0f' % (gaits.trot_km/total*100) }}%</td></tr>
      <tr><td>Cval</td><td>{{ '%.2f' % gaits.canter_km }}</td><td>{{ '%.0f' % (gaits.canter_km/total*100) }}%</td></tr>
    </tbody>
  </table>
</section>

<section class="card">
  <h3>Grafy</h3>
  <div id="chart_km_month"></div>
  <div id="chart_avg_month"></div>
  <div id="chart_km_year"></div>
</section>

<section class="card">
  <h3>Top jízdy</h3>
  <div class="grid">
    <div class="row"><h4>Nejdelší</h4>
      <ol>{% for r in top_long %}<li>{{ r.ride_date }} – {{ '%.2f' % r.distance_km }} km (<a href="/ride/{{ r.id }}">detail</a>)</li>{% endfor %}</ol>
    </div>
    <div class="row"><h4>Nejrychlejší (max)</h4>
      <ol>{% for r in top_fast %}<li>{{ r.ride_date }} – {{ '%.2f' % r.max_speed_kmh }} km/h (<a href="/ride/{{ r.id }}">detail</a>)</li>{% endfor %}</ol>
    </div>
    <div class="row"><h4>Největší převýšení</h4>
      <ol>{% for r in top_climb %}<li>{{ r.ride_date }} – ↑ {{ '%.0f' % r.ascent_m }} m (<a href="/ride/{{ r.id }}">detail</a>)</li>{% endfor %}</ol>
    </div>
  </div>
</section>

<section class="card">
  <h3>Souhrny (měsíční/týdenní/roční)</h3>
  <div class="grid">
    <div class="row">
      <h4>Měsíční</h4>
      <table><thead><tr><th>Období</th><th>Jízd</th><th>Km</th><th>Ø km/h</th></tr></thead>
      <tbody>{% for m in monthly %}<tr><td>{{ m.period }}</td><td>{{ m.rides }}</td><td>{{ '%.2f' % m.km }}</td><td>{{ '%.2f' % m.avg_kmh }}</td></tr>{% endfor %}</tbody></table>
    </div>
    <div class="row">
      <h4>Týdenní</h4>
      <table><thead><tr><th>Období</th><th>Jízd</th><th>Km</th><th>Ø km/h</th></tr></thead>
      <tbody>{% for m in weekly %}<tr><td>{{ m.period }}</td><td>{{ m.rides }}</td><td>{{ '%.2f' % m.km }}</td><td>{{ '%.2f' % m.avg_kmh }}</td></tr>{% endfor %}</tbody></table>
    </div>
    <div class="row">
      <h4>Roční</h4>
      <table><thead><tr><th>Období</th><th>Jízd</th><th>Km</th><th>Ø km/h</th></tr></thead>
      <tbody>{% for m in yearly %}<tr><td>{{ m.period }}</td><td>{{ m.rides }}</td><td>{{ '%.2f' % m.km }}</td><td>{{ '%.2f' % m.avg_kmh }}</td></tr>{% endfor %}</tbody></table>
    </div>
  </div>
</section>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
const kmMonth = {{ km_month | tojson }};
const kmYear = {{ km_year | tojson }};
const avgMonth = {{ avg_month | tojson }};

Plotly.newPlot('chart_km_month',[{x: kmMonth.map(r=>r.period), y: kmMonth.map(r=>r.km), type:'bar'}],{title:'Kilometry za měsíc', margin:{t:30}});
Plotly.newPlot('chart_avg_month',[{x: avgMonth.map(r=>r.period), y: avgMonth.map(r=>r.avg), type:'scatter', mode:'lines+markers'}],{title:'Průměrná rychlost za měsíc', margin:{t:30}});
Plotly.newPlot('chart_km_year',[{x: kmYear.map(r=>r.period), y: kmYear.map(r=>r.km), type:'bar'}],{title:'Kilometry za rok', margin:{t:30}});
</script>
{% endblock %}
